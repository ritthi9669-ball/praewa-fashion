<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Praewa Fashion | ‡∏™‡∏ß‡∏¢ ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à ‡∏ó‡∏∏‡∏Å‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&family=Sriracha&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --primary: #f472b6; --accent: #fbcfe8; --bg: #fff5f7; 
            --text: #502d3c; --muted: #9d7c8a; --white: #ffffff;
            --success: #10b981; --danger: #f87171;
            --soft-pink: #fdf2f8;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #fff5f7 0%, #fbcfe833 100%);
            color: var(--text);
            min-height: 100vh;
        }

        .font-sriracha { font-family: 'Sriracha', cursive; }
        
        /* Decorations */
        .decor-flower { position: fixed; z-index: -1; opacity: 0.4; pointer-events: none; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes heartbeat { 
            0%, 100% { transform: scale(1); } 
            50% { transform: scale(1.1); } 
        }
        .fa-beat-custom { animation: heartbeat 2s infinite; }

        header { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(20px); border-bottom: 2px solid var(--accent); }
        .nav-link { font-size: 13px; font-weight: 600; color: var(--muted); transition: 0.3s; position: relative; }
        .nav-link::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 0; height: 2px; background: var(--primary); transition: 0.3s; }
        .nav-link:hover::after, .nav-link.active::after { width: 100%; }
        .nav-link:hover, .nav-link.active { color: var(--primary); }

        .product-card { border-radius: 40px; transition: 0.4s ease; background: white; border: 1px solid rgba(244, 114, 182, 0.1); }
        .product-card:hover { transform: translateY(-12px); box-shadow: 0 30px 60px -15px rgba(244, 114, 182, 0.3); }
        
        .img-wrap { aspect-ratio: 3/4; border-radius: 32px; overflow: hidden; position: relative; margin: 10px; }
        .img-wrap img { transition: 1.2s; width: 100%; height: 100%; object-fit: cover; }
        .product-card:hover img { transform: scale(1.1); }

        .modal-overlay { position: fixed; inset: 0; background: rgba(80, 45, 60, 0.4); backdrop-filter: blur(8px); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; border-radius: 50px; width: 100%; max-width: 550px; padding: 45px; box-shadow: 0 40px 100px -20px rgba(0, 0, 0, 0.2); border: 2px solid white; }

        .btn-sweet { background: var(--primary); color: white; transition: 0.4s; box-shadow: 0 10px 25px -5px rgba(244, 114, 182, 0.5); border-radius: 99px; }
        .btn-sweet:hover { background: #db2777; transform: translateY(-3px); box-shadow: 0 15px 30px -5px rgba(244, 114, 182, 0.6); }

        .tag-stock { background: rgba(255, 255, 255, 0.9); padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: 700; color: var(--primary); border: 1px solid var(--accent); }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg); }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }
        
        .page { display: none; } 
        .page.show { display: block !important; }
    </style>
</head>
<body>

    <div class="decor-flower" style="top: 5%; left: 2%; font-size: 60px;">üå∏</div>
    <div class="decor-flower" style="top: 40%; right: 2%; font-size: 40px;">üå∏</div>
    <div class="decor-flower" style="bottom: 10%; left: 5%; font-size: 50px;">üå∫</div>

    <div id="globalLoader" class="fixed inset-0 bg-white/90 backdrop-blur-md z-[9999] flex flex-col items-center justify-center text-rose-500" style="display: none;">
        <i class="fas fa-heart fa-beat-custom text-6xl mb-6"></i>
        <p class="font-sriracha text-2xl tracking-wide">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞...</p>
    </div>

    <div id="adminBar" class="text-white bg-stone-900 py-3 px-6 sticky top-0 z-[1001] shadow-xl" style="display: none;">
        <div class="max-w-7xl mx-auto flex justify-between items-center text-[11px]">
            <div class="flex items-center gap-6">
                <span class="text-rose-400 font-bold uppercase tracking-wider"><i class="fas fa-user-shield mr-2"></i> Admin Mode</span>
                <button onclick="openProductModal()" class="hover:text-rose-300 font-bold">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                <button onclick="openSettingsModal()" class="hover:text-rose-300 font-bold">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô</button>
            </div>
            <button onclick="logoutAdmin()" class="bg-rose-500 hover:bg-rose-600 px-5 py-2 rounded-full font-bold transition-all">Logout</button>
        </div>
    </div>

    <header class="sticky top-0 z-[1000] shadow-sm">
        <div class="max-w-7xl mx-auto px-6 h-24 flex justify-between items-center gap-4">
            <div class="flex items-center gap-4 flex-1">
                <button onclick="openLoginModal()" class="p-3 text-rose-200 hover:text-rose-400 transition-all hover:bg-white rounded-full">
                    <i class="fas fa-cog text-xl"></i>
                </button>
                <div class="hidden md:flex items-center bg-white/80 border border-rose-100 rounded-full px-4 py-2 w-64">
                    <i class="fas fa-search text-rose-300 mr-2"></i>
                    <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∏‡∏î‡∏™‡∏ß‡∏¢‡πÜ..." class="bg-transparent border-none outline-none text-xs w-full" oninput="handleSearch(this.value)">
                </div>
            </div>
            
            <div class="text-center shrink-0">
                <a href="#" onclick="showPage('home')" class="text-4xl md:text-5xl font-sriracha text-rose-500 block leading-none">
                    Praewa Fashion
                </a>
            </div>

            <div class="flex items-center gap-4 flex-1 justify-end">
                <button onclick="showPage('cart')" class="relative p-4 bg-rose-500 text-white rounded-full shadow-lg group hover:scale-110 transition-all">
                    <i class="fas fa-shopping-bag text-xl"></i>
                    <span id="cartCount" class="absolute -top-1 -right-1 bg-stone-800 text-white text-[9px] w-6 h-6 rounded-full flex items-center justify-center font-bold border-2 border-white" style="display: none;">0</span>
                </button>
            </div>
        </div>
        <div class="max-w-7xl mx-auto flex justify-center gap-4 md:gap-10 py-5 text-[12px] font-bold uppercase tracking-widest text-stone-500 border-t border-rose-50/50">
            <button onclick="showPage('home')" class="nav-link active" id="nav-home">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
            <button onclick="showPage('shop')" class="nav-link" id="nav-shop">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            <button onclick="showPage('contact')" class="nav-link" id="nav-contact">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-12 min-h-screen">
        
        <!-- PAGE: HOME -->
        <div id="page-home" class="page show animate-fade">
            <div class="relative h-[500px] rounded-[60px] overflow-hidden shadow-2xl mb-24 group">
                <img src="https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=1200" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-rose-200/40 via-transparent flex items-center px-12">
                    <div class="bg-white/80 backdrop-blur-xl p-14 rounded-[50px] max-w-lg shadow-2xl border border-white/50">
                        <h4 class="text-rose-400 font-bold tracking-[0.3em] text-[10px] mb-6 uppercase">Exclusive New Arrivals</h4>
                        <h2 class="text-6xl font-sriracha text-stone-800 mb-6 leading-tight">Sweet & Modern</h2>
                        <button onclick="showPage('shop')" class="btn-sweet px-12 py-5 text-xs font-bold uppercase">‡∏ä‡πâ‡∏≠‡∏õ‡πÄ‡∏•‡∏¢‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
                    </div>
                </div>
            </div>
            <h3 class="text-4xl font-sriracha text-stone-800 mb-12 px-4">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (Best Seller)</h3>
            <div id="homeGrid" class="grid grid-cols-2 lg:grid-cols-4 gap-10"></div>
        </div>

        <!-- PAGE: SHOP -->
        <div id="page-shop" class="page animate-fade">
            <div class="flex flex-col lg:flex-row gap-16">
                <aside class="w-full lg:w-72">
                    <div class="bg-white/80 backdrop-blur-md p-10 rounded-[50px] shadow-sm border border-rose-50 sticky top-32">
                        <h3 class="font-sriracha text-3xl text-rose-500 mb-8 pb-4 border-b-2 border-rose-50">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                        <div class="flex flex-col gap-6 text-sm font-bold text-stone-400" id="categoryFilter">
                            <button onclick="filterCat('‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')" class="text-left hover:text-rose-500 active-cat">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                            <button onclick="filterCat('‡πÄ‡∏™‡∏∑‡πâ‡∏≠')" class="text-left hover:text-rose-500">‡πÄ‡∏™‡∏∑‡πâ‡∏≠</button>
                            <button onclick="filterCat('‡πÄ‡∏î‡∏£‡∏™')" class="text-left hover:text-rose-500">‡πÄ‡∏î‡∏£‡∏™</button>
                            <button onclick="filterCat('‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á')" class="text-left hover:text-rose-500">‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á</button>
                            <button onclick="filterCat('‡∏Å‡∏£‡∏∞‡πÇ‡∏õ‡∏£‡∏á')" class="text-left hover:text-rose-500">‡∏Å‡∏£‡∏∞‡πÇ‡∏õ‡∏£‡∏á</button>
                        </div>
                    </div>
                </aside>
                <div class="flex-1">
                    <div class="flex justify-between items-center mb-12">
                        <h2 id="currentCatTitle" class="text-4xl font-sriracha text-stone-800">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                        <p id="itemCount" class="text-[11px] text-rose-300 font-bold uppercase bg-white px-5 py-2 rounded-full shadow-sm"></p>
                    </div>
                    <div id="shopGrid" class="grid grid-cols-2 lg:grid-cols-3 gap-12"></div>
                </div>
            </div>
        </div>

        <!-- PAGE: DETAIL -->
        <div id="page-detail" class="page animate-fade">
            <div id="detailContent"></div>
        </div>

        <!-- PAGE: CART -->
        <div id="page-cart" class="page animate-fade max-w-5xl mx-auto">
            <div class="text-center mb-16">
                <h2 class="text-5xl font-sriracha text-stone-800 tracking-tighter">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
                <p id="cartItemsLabel" class="text-rose-300 text-sm mt-4 font-bold uppercase"></p>
            </div>
            <div id="cartList" class="space-y-8"></div>
            <div id="cartSummary" class="bg-white p-12 rounded-[60px] shadow-2xl border-2 border-rose-50 flex flex-col md:flex-row justify-between items-center gap-10 mt-16" style="display: none;">
                <div>
                    <p class="text-stone-400 text-xs font-bold uppercase mb-2">‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</p>
                    <h3 id="totalDisplay" class="text-6xl font-bold text-rose-500 tracking-tighter">‡∏ø0</h3>
                </div>
                <button onclick="checkout()" class="bg-stone-900 text-white px-16 py-6 rounded-full text-xs font-bold uppercase tracking-[0.3em] hover:bg-rose-600 transition-all">Confirm Order (LINE)</button>
            </div>
        </div>

        <!-- PAGE: CONTACT -->
        <div id="page-contact" class="page animate-fade max-w-4xl mx-auto">
            <div class="text-center mb-24">
                <h2 class="text-6xl font-sriracha text-stone-800">Contact Us</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
                <a id="linkFB" href="#" target="_blank" class="bg-white p-12 rounded-[60px] shadow-sm border border-rose-50 text-center hover:-translate-y-3 transition-all">
                    <div class="w-20 h-20 bg-blue-50 text-blue-500 rounded-[30px] flex items-center justify-center mx-auto mb-8 shadow-sm"><i class="fab fa-facebook text-4xl"></i></div>
                    <h4 class="font-bold text-xs uppercase mb-3">Facebook</h4>
                </a>
                <a id="linkLine" href="#" target="_blank" class="bg-white p-12 rounded-[60px] shadow-sm border border-rose-50 text-center hover:-translate-y-3 transition-all">
                    <div class="w-20 h-20 bg-green-50 text-green-500 rounded-[30px] flex items-center justify-center mx-auto mb-8 shadow-sm"><i class="fab fa-line text-4xl"></i></div>
                    <h4 class="font-bold text-xs uppercase mb-3">Line ID</h4>
                    <p id="textLineID" class="text-[11px] text-stone-400"></p>
                </a>
                <a id="linkPhone" href="#" class="bg-white p-12 rounded-[60px] shadow-sm border border-rose-50 text-center hover:-translate-y-3 transition-all">
                    <div class="w-20 h-20 bg-rose-50 text-rose-500 rounded-[30px] flex items-center justify-center mx-auto mb-8 shadow-sm"><i class="fas fa-phone-alt text-4xl"></i></div>
                    <h4 class="font-bold text-xs uppercase mb-3">Call Center</h4>
                    <p id="textPhone" class="text-[11px] text-stone-400"></p>
                </a>
            </div>
        </div>

    </main>

    <!-- Modals -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal-content text-center">
            <h3 class="text-4xl font-sriracha mb-10 text-stone-800">Admin Login</h3>
            <input type="password" id="passInp" placeholder="Password (admin1234)" class="w-full bg-stone-50 p-6 rounded-[30px] mb-8 text-center font-bold outline-none border focus:border-rose-300">
            <button onclick="doLogin()" class="btn-sweet w-full py-5 font-bold uppercase text-sm">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <button onclick="closeModals()" class="mt-6 text-stone-300 text-xs font-bold uppercase">Close</button>
        </div>
    </div>

    <!-- Product Form -->
    <div id="productModal" class="modal-overlay">
        <div class="modal-content max-w-xl max-h-[90vh] overflow-hidden flex flex-col p-0 border-0">
            <div class="bg-stone-900 p-8 flex justify-between items-center text-white">
                <h3 id="formTitle" class="text-2xl font-sriracha">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <button onclick="closeModals()"><i class="fas fa-times text-2xl"></i></button>
            </div>
            <form id="pForm" class="p-10 space-y-6 overflow-y-auto flex-1">
                <input type="hidden" id="p_id">
                <div><label class="text-[10px] font-bold text-stone-400 uppercase mb-2 block">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input type="text" id="p_name" required class="w-full bg-stone-50 p-4 rounded-2xl outline-none border focus:border-rose-300"></div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-[10px] font-bold text-stone-400 uppercase mb-2 block">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</label><input type="number" id="p_price" required class="w-full bg-stone-50 p-4 rounded-2xl outline-none"></div>
                    <div><label class="text-[10px] font-bold text-stone-400 uppercase mb-2 block">‡∏™‡∏ï‡πä‡∏≠‡∏Å</label><input type="number" id="p_stock" required class="w-full bg-stone-50 p-4 rounded-2xl outline-none"></div>
                </div>
                <div><label class="text-[10px] font-bold text-stone-400 uppercase mb-2 block">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                    <select id="p_cat" class="w-full bg-stone-50 p-4 rounded-2xl outline-none">
                        <option value="‡πÄ‡∏™‡∏∑‡πâ‡∏≠">‡πÄ‡∏™‡∏∑‡πâ‡∏≠</option>
                        <option value="‡πÄ‡∏î‡∏£‡∏™">‡πÄ‡∏î‡∏£‡∏™</option>
                        <option value="‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á">‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á</option>
                        <option value="‡∏Å‡∏£‡∏∞‡πÇ‡∏õ‡∏£‡∏á">‡∏Å‡∏£‡∏∞‡πÇ‡∏õ‡∏£‡∏á</option>
                    </select>
                </div>
                <div><label class="text-[10px] font-bold text-stone-400 uppercase mb-2 block">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (URL)</label><input type="text" id="p_img" class="w-full bg-stone-50 p-4 rounded-2xl outline-none"></div>
                <div><label class="text-[10px] font-bold text-stone-400 uppercase mb-2 block">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label><textarea id="p_desc" class="w-full bg-stone-50 p-4 rounded-2xl outline-none h-32"></textarea></div>
                <button type="submit" id="submitBtn" class="btn-sweet w-full py-5 font-bold uppercase text-xs">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </form>
        </div>
    </div>

    <!-- Contact Settings -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-3xl font-sriracha mb-10 text-stone-800 text-center">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</h3>
            <div class="space-y-6">
                <div><label class="text-[10px] font-bold uppercase text-stone-400 mb-2 block">Facebook Link</label><input type="text" id="s_fb" class="w-full bg-stone-50 p-4 rounded-2xl outline-none"></div>
                <div><label class="text-[10px] font-bold uppercase text-stone-400 mb-2 block">Line ID</label><input type="text" id="s_line" class="w-full bg-stone-50 p-4 rounded-2xl outline-none"></div>
                <div><label class="text-[10px] font-bold uppercase text-stone-400 mb-2 block">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label><input type="text" id="s_phone" class="w-full bg-stone-50 p-4 rounded-2xl outline-none"></div>
                <button onclick="saveStoreSettings()" class="btn-sweet w-full py-5 font-bold uppercase text-xs mt-6">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
            <button onclick="closeModals()" class="w-full mt-6 text-stone-300 text-xs font-bold uppercase">Cancel</button>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbzexSWRpW2nAsIGUCuMxlg3KZ1uXEmqU7iyGhTukN1wGZ0SDB6VtP14an-o8W4z1miw/exec";

        let products = [];
        let storeSettings = { facebook: '#', line: '@praewa', phone: '081-XXX-XXXX' };
        let cart = [];
        let isAdmin = false;
        let activeCat = '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
        let searchQuery = '';

        window.onload = async () => {
            await fetchData();
            setInterval(fetchData, 60000);
        };

        async function fetchData() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                products = data.products || [];
                if (data.settings) storeSettings = data.settings;
                updateContactUI();
                renderProducts();
            } catch (e) { console.error("Fetch failed:", e); }
        }

        function updateContactUI() {
            document.getElementById('linkFB').href = storeSettings.facebook;
            document.getElementById('linkLine').href = `https://line.me/ti/p/${storeSettings.line}`;
            document.getElementById('linkPhone').href = `tel:${storeSettings.phone}`;
            document.getElementById('textLineID').innerText = storeSettings.line;
            document.getElementById('textPhone').innerText = storeSettings.phone;
        }

        function renderProducts() {
            const filtered = products.filter(p => {
                const matchSearch = p.Name.toLowerCase().includes(searchQuery.toLowerCase()) || 
                                   p.Category.toLowerCase().includes(searchQuery.toLowerCase());
                const matchCat = activeCat === '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' || p.Category === activeCat;
                return matchSearch && matchCat;
            });

            const gridHtml = filtered.map(p => `
                <div class="product-card group relative flex flex-col animate-fade">
                    <div class="img-wrap cursor-pointer shadow-lg" onclick="viewDetail('${p.ID}')">
                        <img src="${p.Image || 'https://via.placeholder.com/400x533'}" alt="${p.Name}">
                        <div class="absolute top-4 left-4"><span class="tag-stock">STOCK: ${p.Stock}</span></div>
                        ${p.Stock <= 0 ? '<div class="absolute inset-0 bg-stone-900/60 flex items-center justify-center backdrop-blur-sm"><span class="bg-white text-stone-800 px-6 py-2 rounded-full font-bold text-xs uppercase tracking-widest">Out of Stock</span></div>' : ''}
                    </div>
                    ${isAdmin ? `
                        <div class="absolute top-8 right-8 flex flex-col gap-3 z-10 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="editItem('${p.ID}')" class="w-12 h-12 bg-white text-blue-500 rounded-full shadow-2xl flex items-center justify-center hover:bg-blue-500 hover:text-white transition-all"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteItem('${p.ID}')" class="w-12 h-12 bg-white text-red-500 rounded-full shadow-2xl flex items-center justify-center hover:bg-red-500 hover:text-white transition-all"><i class="fas fa-trash"></i></button>
                        </div>
                    ` : ''}
                    <div class="p-8 pt-4 text-center">
                        <p class="text-[9px] uppercase tracking-[0.3em] text-rose-300 font-bold mb-2">${p.Category}</p>
                        <h4 class="text-lg font-medium text-stone-700 truncate mb-3 font-prompt">${p.Name}</h4>
                        <p class="text-rose-500 font-bold text-2xl font-prompt">‡∏ø${Number(p.Price).toLocaleString()}</p>
                        <button onclick="addToCart('${p.ID}')" class="mt-6 w-full py-3 rounded-2xl text-[10px] font-bold uppercase transition-all ${p.Stock > 0 ? 'bg-rose-50 text-rose-400 hover:bg-rose-500 hover:text-white' : 'bg-stone-100 text-stone-300 cursor-not-allowed'}">
                            ${p.Stock > 0 ? '‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤' : '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏°‡∏î'}
                        </button>
                    </div>
                </div>
            `).join('');

            document.getElementById('shopGrid').innerHTML = gridHtml || '<p class="col-span-full py-32 text-center text-rose-200 italic font-sriracha text-2xl">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏∞...</p>';
            document.getElementById('homeGrid').innerHTML = filtered.slice(0, 4).map(p => `
                 <div class="product-card group relative bg-white/50 border-none shadow-none hover:shadow-xl transition-all">
                    <div class="img-wrap cursor-pointer" onclick="viewDetail('${p.ID}')">
                        <img src="${p.Image || 'https://via.placeholder.com/400x533'}" class="w-full h-full object-cover">
                    </div>
                    <div class="p-6 text-center">
                        <h4 class="text-sm font-medium truncate font-prompt mb-1">${p.Name}</h4>
                        <p class="text-rose-500 font-bold text-lg font-prompt">‡∏ø${Number(p.Price).toLocaleString()}</p>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('itemCount').innerText = `‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${filtered.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
        }

        function viewDetail(id) {
            const p = products.find(x => x.ID == id);
            if (!p) return;
            
            document.getElementById('detailContent').innerHTML = `
                <div class="bg-white rounded-[70px] overflow-hidden shadow-2xl flex flex-col md:flex-row border border-white animate-fade">
                    <div class="md:w-1/2 aspect-[4/5] overflow-hidden"><img src="${p.Image}" class="w-full h-full object-cover"></div>
                    <div class="md:w-1/2 p-12 md:p-24 flex flex-col justify-center relative overflow-hidden">
                        <p class="text-[10px] font-bold text-rose-300 uppercase tracking-[0.4em] mb-8">Collection / ${p.Category}</p>
                        <h1 class="text-6xl font-sriracha text-stone-800 mb-8 leading-tight">${p.Name}</h1>
                        <p class="text-5xl text-rose-500 font-bold tracking-tighter mb-10">‡∏ø${Number(p.Price).toLocaleString()}</p>
                        <div class="bg-rose-50/50 p-8 rounded-[40px] border border-rose-50 mb-12">
                            <h4 class="text-[11px] font-bold uppercase text-stone-400 mb-4 tracking-widest"><i class="fas fa-info-circle mr-2"></i> Product Details</h4>
                            <p class="text-sm text-stone-500 leading-relaxed font-medium italic">"${p.Description || '‡∏ä‡∏∏‡∏î‡∏™‡∏ß‡∏¢‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° ‡∏™‡∏ß‡∏°‡πÉ‡∏™‡πà‡∏™‡∏ö‡∏≤‡∏¢ ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡πà‡∏ß‡∏á‡∏ó‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì'}"</p>
                        </div>
                        <div class="flex gap-5">
                            <button onclick="addToCart('${p.ID}')" class="flex-1 btn-sweet py-6 rounded-full font-bold text-xs uppercase tracking-[0.3em] ${p.Stock <= 0 ? 'opacity-40 pointer-events-none' : ''}">Add to bag</button>
                            <button onclick="showPage('shop')" class="w-20 h-20 bg-stone-50 rounded-full flex items-center justify-center text-stone-300 hover:text-rose-500 transition-all border border-white"><i class="fas fa-times text-2xl"></i></button>
                        </div>
                    </div>
                </div>
            `;
            showPage('detail');
        }

        function addToCart(id) {
            const p = products.find(x => x.ID == id);
            if (p) { cart.push(p); updateCartUI(); alert("‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ üíñ"); }
        }

        function updateCartUI() {
            const list = document.getElementById('cartList');
            const totalDisplay = document.getElementById('totalDisplay');
            const badge = document.getElementById('cartCount');
            let total = cart.reduce((sum, item) => sum + Number(item.Price), 0);

            if (cart.length === 0) {
                list.innerHTML = `<div class="bg-white p-32 rounded-[70px] text-center shadow-xl border border-rose-50"><i class="fas fa-shopping-bag text-8xl text-rose-100 mb-10"></i><h3 class="text-2xl font-sriracha text-stone-400">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏Ñ‡πà‡∏∞</h3><button onclick="showPage('shop')" class="mt-12 bg-stone-900 text-white px-12 py-5 rounded-full text-xs font-bold uppercase tracking-widest">Go Shopping</button></div>`;
                document.getElementById('cartSummary').style.display = 'none';
                badge.style.display = 'none';
            } else {
                list.innerHTML = cart.map((item, i) => `
                    <div class="bg-white p-8 md:p-12 rounded-[50px] shadow-sm border border-rose-50 flex items-center gap-10">
                        <img src="${item.Image}" class="w-32 h-40 object-cover rounded-[30px] shadow-lg">
                        <div class="flex-1">
                            <p class="text-[10px] text-rose-300 font-bold uppercase mb-2">${item.Category}</p>
                            <h4 class="text-2xl font-medium text-stone-700 font-prompt">${item.Name}</h4>
                            <p class="text-rose-500 font-bold text-3xl mt-4">‡∏ø${Number(item.Price).toLocaleString()}</p>
                        </div>
                        <button onclick="removeFromCart(${i})" class="w-16 h-16 bg-rose-50 text-rose-200 hover:text-red-400 rounded-full transition-all flex items-center justify-center text-2xl"><i class="fas fa-trash-alt"></i></button>
                    </div>`).join('');
                document.getElementById('cartSummary').style.display = 'flex';
                totalDisplay.innerText = `‡∏ø${total.toLocaleString()}`;
                badge.innerText = cart.length;
                badge.style.display = 'flex';
            }
            document.getElementById('cartItemsLabel').innerText = `‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${cart.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞`;
        }

        function removeFromCart(i) { cart.splice(i, 1); updateCartUI(); }

        function checkout() {
            const msg = encodeURIComponent(`‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å Praewa Fashion:\n${cart.map(c => `- ${c.Name} (‡∏ø${c.Price})`).join('\n')}\n‡∏£‡∏ß‡∏°: ‡∏ø${cart.reduce((a,b) => a + Number(b.Price), 0).toLocaleString()}`);
            window.open(`https://line.me/ti/p/${storeSettings.line}?text=${msg}`);
        }

        function handleSearch(val) { searchQuery = val; if (val.trim() !== "") showPage('shop'); renderProducts(); }

        function filterCat(cat) {
            activeCat = cat;
            document.getElementById('currentCatTitle').innerText = cat;
            document.querySelectorAll('#categoryFilter button').forEach(b => {
                const isActive = b.innerText === cat || (cat === '‡πÄ‡∏î‡∏£‡∏™' && b.innerText === '‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏£‡∏™') || (cat === '‡πÄ‡∏™‡∏∑‡πâ‡∏≠' && b.innerText === '‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô');
                b.classList.toggle('text-rose-500', isActive);
                b.classList.toggle('active-cat', isActive);
                b.classList.toggle('translate-x-3', isActive);
            });
            renderProducts();
        }

        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(p => {
                p.classList.remove('show');
                p.style.display = 'none';
            });
            
            const targetPage = document.getElementById(`page-${pageId}`);
            if(targetPage) {
                targetPage.classList.add('show');
                targetPage.style.display = 'block';
            }

            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const nav = document.getElementById(`nav-${pageId}`);
            if (nav) nav.classList.add('active');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function openLoginModal() { document.getElementById('loginModal').style.display = 'flex'; }
        function closeModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); }
        
        function doLogin() {
            if (document.getElementById('passInp').value === 'admin1234') {
                isAdmin = true;
                document.getElementById('adminBar').style.display = 'block';
                closeModals();
                renderProducts();
                alert("‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Ñ‡πà‡∏∞ üå∏");
            } else alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        }

        function logoutAdmin() { isAdmin = false; document.getElementById('adminBar').style.display = 'none'; renderProducts(); }

        function openProductModal() {
            document.getElementById('pForm').reset();
            document.getElementById('p_id').value = "";
            document.getElementById('formTitle').innerText = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á Excel";
            document.getElementById('productModal').style.display = 'flex';
        }

        function editItem(id) {
            const p = products.find(x => x.ID == id);
            document.getElementById('p_id').value = p.ID;
            document.getElementById('p_name').value = p.Name;
            document.getElementById('p_price').value = p.Price;
            document.getElementById('p_stock').value = p.Stock;
            document.getElementById('p_cat').value = p.Category;
            document.getElementById('p_img').value = p.Image;
            document.getElementById('p_desc').value = p.Description || "";
            document.getElementById('formTitle').innerText = "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°";
            document.getElementById('productModal').style.display = 'flex';
        }

        document.getElementById('pForm').onsubmit = async (e) => {
            e.preventDefault();
            const id = document.getElementById('p_id').value;
            const payload = {
                action: id ? 'edit' : 'add',
                id: id || "ID" + Date.now(),
                name: document.getElementById('p_name').value, price: document.getElementById('p_price').value,
                stock: document.getElementById('p_stock').value, category: document.getElementById('p_cat').value,
                image: document.getElementById('p_img').value, description: document.getElementById('p_desc').value,
                size: "S,M,L,XL", color: "‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ"
            };
            showLoader(true);
            try {
                await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
                setTimeout(async () => { await fetchData(); closeModals(); alert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Ñ‡πà‡∏∞ ‚ú®"); showLoader(false); }, 2000);
            } catch(err) { alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î"); showLoader(false); }
        };

        async function deleteItem(id) {
            if (!confirm("‡∏•‡∏ö‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Excel?")) return;
            showLoader(true);
            await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'delete', id }) });
            setTimeout(async () => { await fetchData(); alert("‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); showLoader(false); }, 2000);
        }

        function openSettingsModal() {
            document.getElementById('s_fb').value = storeSettings.facebook;
            document.getElementById('s_line').value = storeSettings.line;
            document.getElementById('s_phone').value = storeSettings.phone;
            document.getElementById('settingsModal').style.display = 'flex';
        }

        async function saveStoreSettings() {
            const payload = { action: 'save_settings', facebook: document.getElementById('s_fb').value, line: document.getElementById('s_line').value, phone: document.getElementById('s_phone').value };
            showLoader(true);
            await fetch(API_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
            setTimeout(async () => { await fetchData(); closeModals(); alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ üå∏"); showLoader(false); }, 2000);
        }

        function showLoader(s) { document.getElementById('globalLoader').style.display = s ? 'flex' : 'none'; }
    </script>
</body>
</html>
