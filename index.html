<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Praewa Fashion | สวย มั่นใจ ทุกสไตล์ของคุณ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&family=Sriracha&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #f472b6; --accent: #fbcfe8; --bg: #fff5f7; 
            --text: #502d3c; --muted: #9d7c8a; --white: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Prompt', sans-serif; background-color: var(--bg); color: var(--text); overflow-x: hidden; }
        button { cursor: pointer; border: none; font-family: inherit; transition: 0.2s; border-radius: 12px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        /* Header & Nav */
        header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-bottom: 2px solid var(--accent); sticky; top: 0; z-index: 1000; }
        .nav-top { height: 70px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: 'Sriracha', cursive; font-size: 32px; color: var(--primary); text-decoration: none; }
        
        .nav-menu { display: flex; justify-content: center; gap: 20px; list-style: none; font-size: 13px; padding: 10px 0; border-top: 1px solid #fdf2f8; }
        .nav-menu li a { text-decoration: none; color: var(--text); font-weight: 500; }
        .nav-menu li a:hover { color: var(--primary); }

        .icon-group { display: flex; gap: 15px; }
        .nav-icon { font-size: 18px; color: var(--primary); position: relative; background: none; }
        .badge { position: absolute; top: -5px; right: -5px; background: #ff4785; color: white; font-size: 10px; width: 16px; height: 16px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        /* Page Transitions */
        .page { display: none; padding-top: 30px; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Home Page */
        .hero { height: 350px; background: linear-gradient(rgba(255,245,247,0.2), rgba(255,245,247,0.2)), url('https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=1200') center/cover; border-radius: 30px; display: flex; align-items: center; justify-content: center; margin-bottom: 40px; }
        .hero-card { background: white; padding: 30px; border-radius: 25px; text-align: center; box-shadow: 0 10px 30px rgba(244, 114, 182, 0.2); }

        /* Product Grid & Sidebar */
        .shop-layout { display: grid; grid-template-columns: 240px 1fr; gap: 30px; }
        .sidebar { background: white; padding: 20px; border-radius: 20px; height: fit-content; }
        .side-title { font-weight: 600; margin-bottom: 15px; border-bottom: 2px solid var(--bg); padding-bottom: 5px; }
        .cat-list { list-style: none; }
        .cat-list li { padding: 8px 0; cursor: pointer; font-size: 14px; transition: 0.2s; }
        .cat-list li:hover { color: var(--primary); padding-left: 5px; }
        .cat-list li.active { color: var(--primary); font-weight: 600; }

        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .p-card { background: white; border-radius: 20px; overflow: hidden; position: relative; border: 1px solid transparent; transition: 0.3s; }
        .p-card:hover { border-color: var(--primary); transform: translateY(-5px); }
        .p-img { aspect-ratio: 3/4; overflow: hidden; background: #fafafa; cursor: pointer; }
        .p-img img { width: 100%; height: 100%; object-fit: cover; }
        .p-info { padding: 15px; text-align: center; }
        .p-price { color: var(--primary); font-weight: 600; }

        /* Product Detail */
        .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; background: white; padding: 40px; border-radius: 30px; }
        .option-group { margin-top: 20px; }
        .opt-title { font-size: 13px; font-weight: 600; margin-bottom: 10px; display: block; }
        .size-box { display: flex; gap: 10px; }
        .size-btn { border: 1px solid #ddd; padding: 5px 12px; border-radius: 8px; background: white; font-size: 12px; }
        .size-btn.selected { border-color: var(--primary); background: var(--bg); color: var(--primary); }

        /* Cart & Checkout */
        .cart-table { width: 100%; border-collapse: collapse; background: white; border-radius: 20px; overflow: hidden; }
        .cart-table th { background: var(--primary); color: white; padding: 15px; text-align: left; }
        .cart-table td { padding: 15px; border-bottom: 1px solid #eee; }
        .checkout-box { background: white; padding: 30px; border-radius: 20px; margin-top: 30px; }

        /* Admin Layer */
        .admin-bar { background: var(--text); color: white; padding: 10px 0; font-size: 12px; display: none; }
        .admin-bar.active { display: block; }
        .btn-main { background: var(--primary); color: white; padding: 12px 25px; font-weight: 600; width: 100%; margin-top: 20px; }

        /* Modals */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal { background: white; width: 100%; max-width: 450px; border-radius: 25px; padding: 30px; position: relative; }
        .form-group { margin-bottom: 15px; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 10px; outline: none; }

        footer { text-align: center; padding: 60px 0; border-top: 4px solid var(--accent); margin-top: 80px; font-size: 12px; color: var(--muted); }
    </style>
</head>
<body>

    <div id="adminBar" class="admin-bar">
        <div class="container" style="display: flex; justify-content: space-between;">
            <span><i class="fas fa-tools"></i> โหมดจัดการร้านค้าเชื่อมต่อ Excel</span>
            <div style="display: flex; gap: 15px;">
                <button onclick="openConfig()" style="background:none; color:white; font-size: 12px;">ตั้งค่า API</button>
                <button onclick="openAddModal()" style="background:none; color:white; font-size: 12px;">+ เพิ่มสินค้า</button>
                <button onclick="logoutAdmin()" style="background:none; color:white; font-size: 12px;">ออกจากระบบ</button>
            </div>
        </div>
    </div>

    <header>
        <div class="container nav-container">
            <div class="nav-top">
                <button onclick="openLogin()" class="nav-icon"><i class="fas fa-cog"></i></button>
                <a href="#" onclick="showPage('home')" class="logo">Praewa Fashion</a>
                <div class="icon-group">
                    <button class="nav-icon"><i class="fas fa-search"></i></button>
                    <button class="nav-icon" onclick="showPage('cart')">
                        <i class="fas fa-shopping-bag"></i>
                        <span id="cartCount" class="badge" style="display:none;">0</span>
                    </button>
                </div>
            </div>
            <ul class="nav-menu">
                <li><a href="#" onclick="showPage('home')">หน้าแรก</a></li>
                <li><a href="#" onclick="showPage('shop')">สินค้า</a></li>
                <li><a href="#">สินค้าใหม่</a></li>
                <li><a href="#">โปรโมชั่น</a></li>
                <li><a href="#">รีวิวลูกค้า</a></li>
                <li><a href="#">ติดต่อเรา</a></li>
            </ul>
        </div>
    </header>

    <div class="container">
        
        <!-- Home Page -->
        <div id="homePage" class="page active">
            <div class="hero">
                <div class="hero-card">
                    <p style="text-transform: uppercase; font-size: 12px; letter-spacing: 2px;">Welcome to Praewa</p>
                    <h1 style="font-family: 'Sriracha'; color: var(--primary); font-size: 42px;">New Collection</h1>
                    <p style="color: var(--muted); margin-bottom: 20px;">สวย มั่นใจ ทุกสไตล์ของคุณ</p>
                    <button class="btn-main" style="width: auto;" onclick="showPage('shop')">ช้อปเลย</button>
                </div>
            </div>
            <h2 style="font-family: 'Sriracha'; text-align: center; margin-bottom: 30px;">สินค้าแนะนำ</h2>
            <div id="featuredGrid" class="product-grid"></div>
        </div>

        <!-- Shop Page -->
        <div id="shopPage" class="page">
            <div class="shop-layout">
                <aside class="sidebar">
                    <div class="side-title">หมวดหมู่สินค้า</div>
                    <ul class="cat-list">
                        <li class="active" onclick="filterCat('ทั้งหมด')">ทั้งหมด</li>
                        <li onclick="filterCat('เดรส')">เดรส</li>
                        <li onclick="filterCat('เสื้อ')">เสื้อ</li>
                        <li onclick="filterCat('กระโปรง')">กระโปรง</li>
                        <li onclick="filterCat('กางเกง')">กางเกง</li>
                    </ul>
                </aside>
                <main>
                    <div id="mainGrid" class="product-grid"></div>
                </main>
            </div>
        </div>

        <!-- Product Detail Page -->
        <div id="detailPage" class="page">
            <div class="detail-grid">
                <div style="border-radius: 20px; overflow: hidden; background: #fafafa;">
                    <img id="detailImg" src="" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
                <div class="detail-info">
                    <h1 id="detailName" style="font-family: 'Sriracha'; color: var(--primary);"></h1>
                    <p id="detailCat" style="color: var(--muted); font-size: 14px;"></p>
                    <h2 id="detailPrice" style="margin: 20px 0; color: var(--text);"></h2>
                    
                    <div class="option-group">
                        <span class="opt-title">เลือกไซส์ (Size)</span>
                        <div class="size-box">
                            <button class="size-btn">S</button>
                            <button class="size-btn selected">M</button>
                            <button class="size-btn">L</button>
                            <button class="size-btn">XL</button>
                        </div>
                    </div>

                    <div class="option-group">
                        <span class="opt-title">เลือกสี (Color)</span>
                        <div class="size-box">
                            <div style="width: 25px; height: 25px; border-radius: 50%; background: #fbcfe8; border: 2px solid white; box-shadow: 0 0 0 1px #eee;"></div>
                            <div style="width: 25px; height: 25px; border-radius: 50%; background: #fff; border: 2px solid white; box-shadow: 0 0 0 1px #eee;"></div>
                        </div>
                    </div>

                    <button class="btn-main" onclick="addToCart()">เพิ่มลงตะกร้า</button>
                    <button class="btn-main" style="background: none; color: var(--muted); border: 1px solid #ddd;" onclick="showPage('shop')">กลับไปช้อปต่อ</button>
                </div>
            </div>
        </div>

        <!-- Cart Page -->
        <div id="cartPage" class="page">
            <h1 style="font-family: 'Sriracha'; margin-bottom: 30px;">ตะกร้าสินค้าของคุณ</h1>
            <table class="cart-table">
                <thead>
                    <tr><th>สินค้า</th><th>ราคา</th><th>จัดการ</th></tr>
                </thead>
                <tbody id="cartItems"></tbody>
            </table>
            <div class="checkout-box">
                <div style="display: flex; justify-content: space-between; font-size: 20px; font-weight: 600; margin-bottom: 20px;">
                    <span>ยอดรวมทั้งสิ้น</span>
                    <span id="cartTotal" style="color: var(--primary);">฿ 0</span>
                </div>
                <button class="btn-main" onclick="showPage('checkout')">ไปหน้าชำระเงิน</button>
            </div>
        </div>

        <!-- Checkout Page -->
        <div id="checkoutPage" class="page">
            <div style="max-width: 600px; margin: 0 auto; background: white; padding: 40px; border-radius: 30px;">
                <h1 style="font-family: 'Sriracha'; text-align: center; margin-bottom: 30px;">ที่อยู่สำหรับจัดส่ง</h1>
                <div class="form-group"><input type="text" placeholder="ชื่อ-นามสกุล"></div>
                <div class="form-group"><input type="text" placeholder="เบอร์โทรศัพท์"></div>
                <div class="form-group"><input type="text" placeholder="ที่อยู่โดยละเอียด"></div>
                <div class="form-group"><input type="text" placeholder="จังหวัด / รหัสไปรษณีย์"></div>
                <div style="margin: 20px 0; padding: 20px; background: var(--bg); border-radius: 15px;">
                    <p style="font-weight: 600;">ช่องทางชำระเงิน</p>
                    <label style="display: block; margin-top: 10px;"><input type="radio" name="pay" checked> โอนเงินผ่าน PromptPay</label>
                    <label style="display: block;"><input type="radio" name="pay"> เก็บเงินปลายทาง</label>
                </div>
                <button class="btn-main" onclick="alert('สั่งซื้อสำเร็จ! ระบบจะส่งข้อมูลไปทาง Line')">ยืนยันการสั่งซื้อ</button>
            </div>
        </div>

    </div>

    <!-- Modals -->
    <div id="loginModal" class="modal-overlay">
        <div class="modal" style="max-width: 320px;">
            <h3 style="margin-bottom: 20px;">แอดมินล็อกอิน</h3>
            <input type="password" id="adminPass" placeholder="รหัสผ่าน (admin1234)" style="width:100%; padding:12px; margin-bottom:15px; border-radius:10px; border:1px solid #eee;">
            <button class="btn-block" onclick="doLogin()">เข้าสู่ระบบ</button>
            <button class="btn-block" style="background:none; color:#999;" onclick="closeModals()">ปิด</button>
        </div>
    </div>

    <div id="addModal" class="modal-overlay">
        <div class="modal">
            <h3>เพิ่ม/แก้ไขสินค้า</h3>
            <div class="form-group"><input type="text" id="pName" placeholder="ชื่อสินค้า"></div>
            <div class="form-group"><input type="number" id="pPrice" placeholder="ราคา"></div>
            <div class="form-group">
                <select id="pCat">
                    <option value="เดรส">เดรส</option><option value="เสื้อ">เสื้อ</option>
                    <option value="กระโปรง">กระโปรง</option><option value="กางเกง">กางเกง</option>
                </select>
            </div>
            <div class="form-group"><input type="text" id="pImg" placeholder="ลิงก์รูปภาพ URL"></div>
            <button class="btn-block" onclick="saveToExcel()">บันทึกลง Excel</button>
            <button class="btn-block" style="background:none; color:#999;" onclick="closeModals()">ยกเลิก</button>
        </div>
    </div>

    <div id="configModal" class="modal-overlay">
        <div class="modal">
            <h3>ตั้งค่าเชื่อมต่อ Excel</h3>
            <input type="text" id="apiUrlInp" placeholder="Deployment URL" style="width:100%; padding:12px; margin: 15px 0;">
            <button class="btn-block" onclick="saveApiUrl()">บันทึก</button>
        </div>
    </div>

    <div id="loader" style="position:fixed; inset:0; background:rgba(255,255,255,0.8); z-index:3000; display:none; flex-direction:column; align-items:center; justify-content:center;">
        <i class="fas fa-heart fa-beat" style="font-size: 40px; color: var(--primary);"></i>
        <p style="margin-top:15px;">กำลังจัดการข้อมูล...</p>
    </div>

    <footer>
        <span class="logo" style="font-size: 24px;">Praewa Fashion</span>
        <p>&copy; 2026 ระบบร้านค้าแฟชั่นออนไลน์ | เชื่อมต่อฐานข้อมูล Excel อัตโนมัติ</p>
    </footer>

    <script>
        let products = [];
        let cart = [];
        let activeCat = 'ทั้งหมด';
        let isAdmin = false;
        let selectedProduct = null;
        let apiUrl = localStorage.getItem('praewa_api_url') || '';

        async function init() {
            if (!apiUrl) {
                products = [{ Name: 'กรุณาตั้งค่า API', Price: 0, Category: 'เดรส', Image: '', ID: '0' }];
                renderProducts();
                return;
            }
            showLoader(true);
            try {
                const res = await fetch(apiUrl);
                products = await res.json();
                renderProducts();
            } catch (e) { console.error(e); }
            showLoader(false);
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId + 'Page').classList.add('active');
            window.scrollTo(0, 0);
        }

        function renderProducts() {
            const mainGrid = document.getElementById('mainGrid');
            const featuredGrid = document.getElementById('featuredGrid');
            
            const filtered = activeCat === 'ทั้งหมด' ? products : products.filter(p => p.Category === activeCat);
            
            const html = filtered.map(p => `
                <div class="p-card">
                    <div class="p-img" onclick="viewDetail('${p.ID}')"><img src="${p.Image || 'https://via.placeholder.com/300x400'}" alt=""></div>
                    ${isAdmin ? `<button class="btn-del" onclick="deleteItem('${p.ID}')"><i class="fas fa-trash"></i></button>` : ''}
                    <div class="p-info">
                        <div style="font-size:11px; color:var(--primary); font-weight:600;">${p.Category}</div>
                        <div style="font-size:14px; font-weight:500;">${p.Name}</div>
                        <div class="p-price">฿ ${Number(p.Price).toLocaleString()}</div>
                    </div>
                </div>
            `).join('');

            mainGrid.innerHTML = html;
            if(featuredGrid) featuredGrid.innerHTML = html;
        }

        function viewDetail(id) {
            const p = products.find(x => x.ID == id);
            if (!p) return;
            selectedProduct = p;
            document.getElementById('detailName').innerText = p.Name;
            document.getElementById('detailCat').innerText = p.Category;
            document.getElementById('detailPrice').innerText = '฿ ' + Number(p.Price).toLocaleString();
            document.getElementById('detailImg').src = p.Image || '';
            showPage('detail');
        }

        function addToCart() {
            cart.push(selectedProduct);
            updateCartUI();
            alert("เพิ่มลงตะกร้าแล้ว!");
        }

        function updateCartUI() {
            const list = document.getElementById('cartItems');
            const totalEl = document.getElementById('cartTotal');
            const badge = document.getElementById('cartCount');
            let total = 0;
            
            list.innerHTML = cart.map((item, i) => {
                total += Number(item.Price);
                return `<tr>
                    <td><div style="display:flex; gap:10px;"><img src="${item.Image}" width="40">${item.Name}</div></td>
                    <td>฿ ${Number(item.Price).toLocaleString()}</td>
                    <td><button onclick="removeFromCart(${i})" style="background:none; color:red;"><i class="fas fa-times"></i></button></td>
                </tr>`;
            }).join('');

            badge.innerText = cart.length;
            badge.style.display = cart.length > 0 ? 'flex' : 'none';
            totalEl.innerText = '฿ ' + total.toLocaleString();
        }

        function removeFromCart(i) { cart.splice(i, 1); updateCartUI(); }

        function filterCat(cat) {
            activeCat = cat;
            document.querySelectorAll('.cat-list li').forEach(li => li.classList.toggle('active', li.innerText === cat));
            renderProducts();
        }

        // --- Backend Sync ---
        async function saveToExcel() {
            const item = {
                action: 'add',
                name: document.getElementById('pName').value,
                price: document.getElementById('pPrice').value,
                category: document.getElementById('pCat').value,
                image: document.getElementById('pImg').value,
                id: Date.now().toString()
            };
            showLoader(true);
            await fetch(apiUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify(item) });
            products.push({ Name: item.name, Price: item.price, Category: item.category, Image: item.image, ID: item.id });
            renderProducts(); closeModals(); showLoader(false);
        }

        async function deleteItem(id) {
            if (!confirm("ลบออกจาก Excel?")) return;
            showLoader(true);
            await fetch(apiUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: 'delete', id: id }) });
            products = products.filter(p => p.ID != id);
            renderProducts(); showLoader(false);
        }

        // --- UI Utilities ---
        function toggleAdmin() { document.getElementById('loginModal').style.display = 'flex'; }
        function doLogin() {
            if (document.getElementById('adminPass').value === 'admin1234') {
                isAdmin = true; document.getElementById('adminBar').classList.add('active'); closeModals(); renderProducts();
            } else alert("รหัสผิด");
        }
        function logoutAdmin() { isAdmin = false; document.getElementById('adminBar').classList.remove('active'); renderProducts(); }
        function openConfig() { document.getElementById('configModal').style.display = 'flex'; document.getElementById('apiUrlInp').value = apiUrl; }
        function saveApiUrl() { apiUrl = document.getElementById('apiUrlInp').value; localStorage.setItem('praewa_api_url', apiUrl); closeModals(); init(); }
        function openAddModal() { document.getElementById('addModal').style.display = 'flex'; }
        function closeModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); }
        function showLoader(s) { document.getElementById('loader').style.display = s ? 'flex' : 'none'; }

        window.onload = init;
    </script>
</body>
</html>
